<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ä¼Šå¯ Yike | æƒ…ä¾£å°çª</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['system-ui', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', 'sans-serif'] },
                    colors: {
                        bg: '#FDFBF7',
                        primary: '#E8CFC8',
                        primaryDark: '#D4A5A5',
                        secondary: '#D4E4E6',
                        secondaryLight: '#E8F0F2',
                        text: '#4A403A',
                        textLight: '#9CA3AF',
                        textLighter: '#C4BEB9',
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'float': 'float 3s ease-in-out infinite',
                        'pulse-soft': 'pulse 2s ease-in-out infinite',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { transform: 'translateY(15px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-8px)' } },
                    }
                }
            }
        }
    </script>

    <!-- æ ¸å¿ƒä¾èµ–åº“ - ä½¿ç”¨å›½å†…ç¨³å®šCDN -->
    <script src="https://cdn.staticfile.net/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdn.staticfile.net/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.staticfile.net/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.staticfile.net/peerjs/1.5.2/peerjs.min.js"></script>

    <style>
        body { background: #E5E7EB; display: flex; justify-content: center; margin: 0; min-height: 100vh; }
        #app-container { width: 100%; max-width: 400px; height: 100dvh; background: #FDFBF7; position: relative; overflow: hidden; box-shadow: 0 0 60px rgba(0,0,0,0.08); }
        .glass { background: rgba(255,255,255,0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.6); }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        @keyframes heartbeat { 0%, 100% { transform: scale(1); } 14% { transform: scale(1.15); } 28% { transform: scale(1); } 42% { transform: scale(1.15); } 70% { transform: scale(1); } }
        .heartbeat { animation: heartbeat 1.6s ease-in-out infinite; }
        
        .jelly-btn { transition: all 0.15s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .jelly-btn:active { transform: scale(0.94); }
        
        .input-code { font-size: 24px; letter-spacing: 8px; font-family: 'Courier New', monospace; font-weight: bold; }
        
        @keyframes connect-pulse { 0%, 100% { box-shadow: 0 0 0 0 rgba(168, 201, 168, 0.4); } 50% { box-shadow: 0 0 0 12px rgba(168, 201, 168, 0); } }
        .connect-success { animation: connect-pulse 2s infinite; }
    </style>
</head>
<body>
    <div id="app-container">
        <div id="root"></div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback, useMemo } = React;

        // ============ å·¥å…·å‡½æ•° ============
        const generateId = () => Math.random().toString(36).substr(2, 9) + Date.now().toString(36);
        const formatTime = (ts) => {
            if (!ts) return '';
            const d = new Date(ts);
            return `${d.getMonth()+1}/${d.getDate()} ${d.getHours().toString().padStart(2,'0')}:${d.getMinutes().toString().padStart(2,'0')}`;
        };
        const formatDateOnly = (ts) => {
            if (!ts) return '';
            const d = new Date(ts);
            return `${d.getFullYear()}-${(d.getMonth()+1).toString().padStart(2,'0')}-${d.getDate().toString().padStart(2,'0')}`;
        };
        const getDays = (ts) => {
            if (!ts) return 0;
            const start = new Date(ts);
            const now = new Date();
            start.setHours(0,0,0,0);
            now.setHours(0,0,0,0);
            return Math.floor((now - start) / (1000 * 60 * 60 * 24));
        };

        // ============ æœ¬åœ°å­˜å‚¨å·¥å…· ============
        const Storage = {
            get: (key) => {
                try {
                    return JSON.parse(localStorage.getItem(key) || '[]');
                } catch { return []; }
            },
            set: (key, val) => {
                try {
                    localStorage.setItem(key, JSON.stringify(val));
                } catch(e) {}
            },
            remove: (key) => {
                try {
                    localStorage.removeItem(key);
                } catch(e) {}
            },
            clearAll: () => {
                try {
                    const keys = Object.keys(localStorage).filter(k => k.startsWith('yike_'));
                    keys.forEach(k => localStorage.removeItem(k));
                } catch(e) {}
            }
        };

        // ============ å›¾æ ‡åº“ ============
        const Icons = {
            Heart: ({className}) => <svg className={className} viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="1.5"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>,
            Home: ({className}) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
            Msg: ({className}) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>,
            List: ({className}) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>,
            Plus: ({className}) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
            Send: ({className}) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>,
            Check: ({className}) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="20 6 9 17 4 12"/></svg>,
            Setting: ({className}) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 1 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>,
            Trash: ({className}) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>,
            Refresh: ({className}) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>,
            Close: ({className}) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
            Calendar: ({className}) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>,
            Copy: ({className}) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>,
            Star: ({className}) => <svg className={className} viewBox="0 0 24 24" fill="currentColor"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
        };

        // ============ ç”Ÿæˆ6ä½æ•°å­—æš—å· ============
        const generateCode = () => {
            return Math.floor(100000 + Math.random() * 900000).toString();
        };

        // ============ ä¸»åº”ç”¨ç»„ä»¶ ============
        function App() {
            const [view, setView] = useState('loading');
            const [tab, setTab] = useState('home');
            const [showSettings, setShowSettings] = useState(false);
            const [toast, setToast] = useState(null);
            
            const [myId, setMyId] = useState('');
            const [myCode, setMyCode] = useState('');
            const [partnerId, setPartnerId] = useState('');
            const [partnerCode, setPartnerCode] = useState('');
            const [anniversary, setAnniversary] = useState(null);
            const [messages, setMessages] = useState([]);
            const [todos, setTodos] = useState([]);
            
            const [connStatus, setConnStatus] = useState('disconnected');
            const [conn, setConn] = useState(null);
            const [connectError, setConnectError] = useState(null);
            const peerRef = useRef(null);
            const reconnectTimerRef = useRef(null);
            const isMountedRef = useRef(false);

            // åˆå§‹åŒ–
            useEffect(() => {
                isMountedRef.current = true;
                
                // è¯»å–æœ¬åœ°å­˜å‚¨
                const savedMyId = localStorage.getItem('yike_myId');
                const savedPartnerId = localStorage.getItem('yike_partnerId');
                const savedAnniversary = localStorage.getItem('yike_anniversary');
                const savedMsgs = Storage.get('yike_msgs');
                const savedTodos = Storage.get('yike_todos');

                if (savedAnniversary) setAnniversary(Number(savedAnniversary));
                if (savedMsgs) setMessages(savedMsgs);
                if (savedTodos) setTodos(savedTodos);

                // ç”Ÿæˆæˆ–è¯»å–æˆ‘çš„IDå’Œæš—å·
                let finalMyId = savedMyId;
                let finalMyCode = localStorage.getItem('yike_myCode');
                if (!finalMyId) {
                    finalMyId = generateId();
                    finalMyCode = generateCode();
                    localStorage.setItem('yike_myId', finalMyId);
                    localStorage.setItem('yike_myCode', finalMyCode);
                }
                if (!finalMyCode) {
                    finalMyCode = generateCode();
                    localStorage.setItem('yike_myCode', finalMyCode);
                }
                setMyId(finalMyId);
                setMyCode(finalMyCode);

                // æ£€æŸ¥æ˜¯å¦å·²é…å¯¹
                if (savedPartnerId) {
                    setPartnerId(savedPartnerId);
                    const savedPartnerCode = localStorage.getItem('yike_partnerCode');
                    if (savedPartnerCode) setPartnerCode(savedPartnerCode);
                    
                    // è‡ªåŠ¨è¿›å…¥ä¸»é¡µ
                    setView('home');
                    
                    // åå°é™é»˜é‡è¿ï¼ˆå¸¦5ç§’è¶…æ—¶ï¼‰
                    setTimeout(() => {
                        initPeerWithTimeout(finalMyId, savedPartnerId);
                    }, 300);
                } else {
                    setView('login');
                }

                return () => {
                    isMountedRef.current = false;
                    cleanupPeer();
                };
            }, []);

            // æ¸…ç† PeerJS è¿æ¥
            const cleanupPeer = useCallback(() => {
                if (peerRef.current) {
                    try {
                        peerRef.current.destroy();
                    } catch(e) {}
                    peerRef.current = null;
                }
                if (reconnectTimerRef.current) {
                    clearTimeout(reconnectTimerRef.current);
                    reconnectTimerRef.current = null;
                }
            }, []);

            // å¸¦è¶…æ—¶çš„ PeerJS åˆå§‹åŒ–
            const initPeerWithTimeout = useCallback((id, pid) => {
                if (!pid || !isMountedRef.current) return;
                
                cleanupPeer();
                setConnectError(null);
                setConnStatus('connecting');
                console.log('ğŸ”„ åˆå§‹åŒ–è¿æ¥:', { myId: id, partnerId: pid });

                // 5ç§’è¶…æ—¶å¼ºåˆ¶é€€å‡º
                const timeoutId = setTimeout(() => {
                    if (!isMountedRef.current) return;
                    console.log('â±ï¸ è¿æ¥è¶…æ—¶');
                    cleanupPeer();
                    setConnStatus('disconnected');
                    setConnectError('è¿æ¥è¶…æ—¶ï¼Œå¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜ï¼Œè¯·æ£€æŸ¥åé‡è¯•');
                }, 5000);

                try {
                    const peer = new Peer(id, {
                        debug: 1,
                        config: {
                            iceServers: [
                                { urls: 'stun:stun.l.google.com:19302' },
                                { urls: 'stun:stun1.l.google.com:19302' },
                            ]
                        }
                    });
                    peerRef.current = peer;

                    // Peer æ‰“å¼€æˆåŠŸ
                    peer.on('open', (peerId) => {
                        console.log('âœ… Peer æ‰“å¼€:', peerId);
                        if (!isMountedRef.current) {
                            clearTimeout(timeoutId);
                            return;
                        }
                        setConnStatus('waiting');
                        
                        // å»¶è¿Ÿä¸€ç‚¹å†å‘èµ·è¿æ¥ï¼Œç»™å¯¹æ–¹æ—¶é—´
                        setTimeout(() => {
                            if (peerRef.current === peer && !conn && isMountedRef.current) {
                                console.log('ğŸ”— å‘èµ·è¿æ¥åˆ°:', pid);
                                const connection = peer.connect(pid, { 
                                    reliable: true, 
                                    serialization: 'json'
                                });
                                setupConnection(connection, timeoutId);
                            }
                        }, 800);
                    });

                    // æ”¶åˆ°ä¼ å…¥è¿æ¥
                    peer.on('connection', (connection) => {
                        console.log('ğŸ“¥ æ”¶åˆ°è¿æ¥è¯·æ±‚');
                        if (!isMountedRef.current) {
                            clearTimeout(timeoutId);
                            return;
                        }
                        clearTimeout(timeoutId);
                        setupConnection(connection);
                    });

                    // é”™è¯¯å¤„ç†
                    peer.on('error', (err) => {
                        console.error('âŒ Peer é”™è¯¯:', err);
                        if (!isMountedRef.current) return;
                        clearTimeout(timeoutId);
                        cleanupPeer();
                        
                        let errorMsg = 'è¿æ¥å¤±è´¥ï¼Œè¯·é‡è¯•';
                        if (err.type === 'peer-unavailable') {
                            errorMsg = 'å¯¹æ–¹æš‚ä¸åœ¨çº¿ï¼Œè¯·ç¨åå†è¯•';
                        } else if (err.type === 'unavailable-id') {
                            errorMsg = 'æš—å·å·²è¢«å ç”¨ï¼Œè¯·é‡æ–°ç”Ÿæˆ';
                        } else if (err.type === 'network') {
                            errorMsg = 'ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ';
                        }
                        setConnStatus('disconnected');
                        setConnectError(errorMsg);
                    });

                } catch (e) {
                    console.error('âŒ åˆå§‹åŒ–å¤±è´¥:', e);
                    if (!isMountedRef.current) return;
                    clearTimeout(timeoutId);
                    setConnStatus('disconnected');
                    setConnectError('åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                }
            }, [conn, cleanupPeer]);

            // è®¾ç½®è¿æ¥
            const setupConnection = useCallback((connection, timeoutId = null) => {
                if (!isMountedRef.current) {
                    if (timeoutId) clearTimeout(timeoutId);
                    return;
                }
                if (timeoutId) clearTimeout(timeoutId);

                console.log('ğŸ¤ è¿æ¥å»ºç«‹ä¸­...');
                
                connection.on('open', () => {
                    console.log('âœ… è¿æ¥æˆåŠŸï¼');
                    if (!isMountedRef.current) return;
                    setConn(connection);
                    setConnStatus('connected');
                    setConnectError(null);
                    
                    // å‘é€æ¡æ‰‹æ¶ˆæ¯
                    connection.send({ 
                        type: 'handshake', 
                        payload: { myId, timestamp: Date.now() }
                    });
                });

                connection.on('data', (data) => {
                    console.log('ğŸ“¨ æ”¶åˆ°æ•°æ®:', data.type);
                    if (!isMountedRef.current) return;
                    
                    if (data.type === 'handshake') {
                        // å›å¤æ¡æ‰‹
                        if (connection.open) {
                            connection.send({ 
                                type: 'handshake-ack', 
                                payload: { myId, timestamp: Date.now() } 
                            });
                        }
                        setConnStatus('connected');
                        showToast('â¤ï¸ å·²è¿æ¥');
                    } else if (data.type === 'handshake-ack') {
                        showToast('â¤ï¸ å·²è¿æ¥');
                    } else if (data.type === 'msg') {
                        const newMsg = data.payload;
                        setMessages(prev => {
                            const newMsgs = [...prev, newMsg];
                            Storage.set('yike_msgs', newMsgs);
                            return newMsgs;
                        });
                        showToast('æ”¶åˆ°æ–°æ¶ˆæ¯');
                    } else if (data.type === 'todo') {
                        const newTodo = data.payload;
                        setTodos(prev => {
                            const newTodos = [...prev, newTodo];
                            Storage.set('yike_todos', newTodos);
                            return newTodos;
                        });
                        showToast('æ”¶åˆ°æ–°å¾…åŠ');
                    } else if (data.type === 'anniversary') {
                        setAnniversary(data.payload);
                        localStorage.setItem('yike_anniversary', data.payload);
                    }
                });

                connection.on('close', () => {
                    console.log('ğŸ”´ è¿æ¥æ–­å¼€');
                    if (!isMountedRef.current) return;
                    setConnStatus('disconnected');
                    setConn(null);
                    showToast('è¿æ¥å·²æ–­å¼€');
                    
                    // 3ç§’åè‡ªåŠ¨é‡è¿
                    reconnectTimerRef.current = setTimeout(() => {
                        if (partnerId && isMountedRef.current) {
                            initPeerWithTimeout(myId, partnerId);
                        }
                    }, 3000);
                });

                connection.on('error', (err) => {
                    console.error('è¿æ¥é”™è¯¯:', err);
                    if (!isMountedRef.current) return;
                });
            }, [myId, partnerId, initPeerWithTimeout]);

            const handleReconnect = useCallback(() => {
                if (partnerId) {
                    showToast('æ­£åœ¨é‡è¿...');
                    initPeerWithTimeout(myId, partnerId);
                }
            }, [partnerId, myId, initPeerWithTimeout]);

            const sendData = useCallback((type, payload) => {
                // å…ˆä¿å­˜åˆ°æœ¬åœ°
                if (type === 'msg') {
                    const newMsg = { ...payload, self: true };
                    setMessages(prev => {
                        const newMsgs = [...prev, newMsg];
                        Storage.set('yike_msgs', newMsgs);
                        return newMsgs;
                    });
                } else if (type === 'todo') {
                    const newTodo = { ...payload, self: true };
                    setTodos(prev => {
                        const newTodos = [...prev, newTodo];
                        Storage.set('yike_todos', newTodos);
                        return newTodos;
                    });
                } else if (type === 'anniversary') {
                    setAnniversary(payload);
                    localStorage.setItem('yike_anniversary', payload);
                }

                // å¦‚æœå·²è¿æ¥ï¼Œå‘é€ç»™å¯¹æ–¹
                if (conn && conn.open) {
                    conn.send({ type, payload });
                }
            }, [conn]);

            const showToast = useCallback((msg) => {
                setToast(msg);
                setTimeout(() => setToast(null), 2500);
            }, []);

            const handlePair = useCallback((code) => {
                if (!code || code.length !== 6) {
                    alert('è¯·è¾“å…¥6ä½æ•°å­—æš—å·');
                    return;
                }
                
                // æ¸…é™¤æ—§è¿æ¥
                cleanupPeer();
                
                // ä¿å­˜å¯¹æ–¹çš„æš—å·
                localStorage.setItem('yike_partnerCode', code);
                setPartnerCode(code);
                
                // è®¡ç®—å¯¹æ–¹çš„IDï¼ˆæš—å·æ˜¯å¯¹æ–¹IDçš„å6ä½ï¼‰
                // å®é™…é€»è¾‘ï¼šå¯¹æ–¹ä¼šç”¨ä»–ä»¬çš„æš—å·æ¥ç›‘å¬ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨æš—å·ä½œä¸ºIDåç¼€æ¥è¿æ¥
                const estimatedPartnerId = 'yike_' + code;
                
                // å…ˆè¿›å…¥ä¸»é¡µ
                localStorage.setItem('yike_partnerId', estimatedPartnerId);
                setPartnerId(estimatedPartnerId);
                setView('home');
                
                // ç„¶åå°è¯•è¿æ¥
                setTimeout(() => {
                    initPeerWithTimeout(myId, estimatedPartnerId);
                }, 500);
            }, [myId, cleanupPeer, initPeerWithTimeout]);

            const handleCreate = useCallback(() => {
                // æ¸…é™¤æ—§è¿æ¥
                cleanupPeer();
                
                // é‡æ–°ç”Ÿæˆæš—å·ä¸º6ä½
                const newCode = generateCode();
                const newId = 'yike_' + newCode;
                
                // ä¿å­˜æ–°çš„IDå’Œæš—å·
                localStorage.setItem('yike_myId', newId);
                localStorage.setItem('yike_myCode', newCode);
                setMyId(newId);
                setMyCode(newCode);
                
                setView('create');
                
                // ç«‹å³åˆå§‹åŒ– Peer å¼€å§‹ç­‰å¾…è¿æ¥
                setTimeout(() => {
                    initPeerWithTimeout(newId, null);
                }, 300);
            }, [cleanupPeer, initPeerWithTimeout]);

            // ç™»å½•é¡µ
            if (view === 'login') {
                return (
                    <LoginView 
                        myCode={myCode}
                        connStatus={connStatus}
                        connectError={connectError}
                        onPair={handlePair}
                        onCreate={handleCreate}
                    />
                );
            }

            // åˆ›å»ºé¡µ
            if (view === 'create') {
                return (
                    <CreateView 
                        myCode={myCode}
                        connStatus={connStatus}
                        connectError={connectError}
                        onBack={() => {
                            cleanupPeer();
                            setView('login');
                        }}
                    />
                );
            }

            // é¦–é¡µ
            const days = getDays(anniversary);
            const timelineData = useMemo(() => {
                const m = messages.map(m => ({...m, kind: 'msg'}));
                const t = todos.map(t => ({...t, kind: 'todo'}));
                return [...m, ...t].sort((a, b) => b.ts - a.ts);
            }, [messages, todos]);

            return (
                <div className="h-full flex flex-col bg-[#FDFBF7] relative overflow-hidden">
                    
                    {/* åŠ¨æ€èƒŒæ™¯å…‰æ–‘ */}
                    <div className="absolute inset-0 pointer-events-none overflow-hidden">
                        <div className="absolute top-[-20%] right-[-10%] w-[80%] h-[80%] rounded-full bg-[#E8CFC8]/20 blur-[100px] animate-float"></div>
                        <div className="absolute bottom-[-20%] left-[-10%] w-[80%] h-[80%] rounded-full bg-[#D4E4E6]/20 blur-[100px] animate-float" style={{animationDelay: '1.5s'}}></div>
                    </div>

                    {/* é¡¶éƒ¨çŠ¶æ€æ  */}
                    <header className="relative z-10 px-5 pt-8 pb-3 flex justify-between items-center">
                        <div className="flex items-center gap-2">
                            <div className={`w-2.5 h-2.5 rounded-full transition-all duration-500 ${
                                connStatus === 'connected' ? 'bg-green-400 connect-success' : 
                                connStatus === 'connecting' ? 'bg-yellow-400 animate-pulse' : 
                                connStatus === 'waiting' ? 'bg-yellow-400 animate-pulse' : 'bg-gray-300'
                            }`}></div>
                            <span className="text-xs font-medium text-gray-500">
                                {connStatus === 'connected' ? 'TA åœ¨çº¿' : 
                                 connStatus === 'connecting' ? 'è¿æ¥ä¸­...' : 
                                 connStatus === 'waiting' ? 'ç­‰å¾…å¯¹æ–¹...' : 
                                 connectError ? connectError.slice(0, 10) + '...' : 'ç¦»çº¿'}
                            </span>
                        </div>
                        <div className="flex items-center gap-2">
                            {connStatus !== 'connected' && (
                                <button onClick={handleReconnect} className="w-8 h-8 rounded-full bg-white/70 text-gray-400 hover:text-gray-600 flex items-center justify-center jelly-btn">
                                    <Icons.Refresh className="w-4 h-4" />
                                </button>
                            )}
                            <button onClick={() => setShowSettings(true)} className="w-8 h-8 rounded-full bg-white/70 text-gray-500 hover:text-gray-700 flex items-center justify-center jelly-btn">
                                <Icons.Setting className="w-4 h-4" />
                            </button>
                        </div>
                    </header>

                    {/* è¿æ¥é”™è¯¯æç¤º */}
                    {connectError && (
                        <div className="relative z-10 mx-5 mb-2 bg-red-50 text-red-500 px-4 py-2 rounded-xl text-xs flex items-center justify-between">
                            <span>{connectError}</span>
                            <button onClick={handleReconnect} className="text-red-600 font-bold ml-2">é‡è¯•</button>
                        </div>
                    )}

                    {/* çºªå¿µæ—¥å¡ç‰‡ */}
                    <div className="relative z-10 px-5 pb-4">
                        <div className="glass rounded-3xl p-5 shadow-sm flex items-center justify-between">
                            <div>
                                <div className="flex items-baseline gap-1">
                                    <p className="text-xs text-gray-500">ç›¸çˆ±</p>
                                    <span className="text-4xl font-bold text-[#4A403A]">{days}</span>
                                    <span className="text-lg text-gray-500 font-medium">å¤©</span>
                                </div>
                                <p className="text-xs text-gray-400 mt-1">
                                    {anniversary ? 'å§‹äº ' + formatDateOnly(anniversary) : 'è®¾ç½®çºªå¿µæ—¥å¼€å§‹è®¡æ—¶'}
                                </p>
                            </div>
                            <div className={`w-14 h-14 rounded-full flex items-center justify-center transition-all ${tab === 'home' ? 'bg-[#E8CFC8]/20 text-[#E8CFC8]' : 'bg-gray-100 text-gray-300'}`}>
                                <Icons.Heart className={`w-7 h-7 ${tab === 'home' ? 'text-[#E8CFC8] heartbeat' : ''}`} />
                            </div>
                        </div>
                    </div>

                    {/* å†…å®¹åŒº */}
                    <main className="flex-1 overflow-y-auto hide-scrollbar px-4 pb-24 relative z-0">
                        {tab === 'home' && (
                            <div className="space-y-3 pt-2">
                                {timelineData.length === 0 ? (
                                    <div className="flex flex-col items-center justify-center py-20">
                                        <div className="text-6xl mb-4">ğŸŒ±</div>
                                        <p className="text-gray-400 text-center mb-6 text-sm">å°çªè¿˜æ˜¯ç©ºçš„ï¼Œ<br/>å¿«å»æ ‘æ´æˆ–å¾…åŠé‡Œç•™ä¸‹ç‚¹ä»€ä¹ˆå§</p>
                                        <div className="flex gap-2">
                                            <button onClick={() => setTab('msg')} className="px-4 py-2 bg-[#E8CFC8]/20 text-[#D4A5A5] rounded-full text-sm jelly-btn">å»æ ‘æ´</button>
                                            <button onClick={() => setTab('todo')} className="px-4 py-2 bg-[#D4E4E6]/20 text-[#9CA3AF] rounded-full text-sm jelly-btn">å»å¾…åŠ</button>
                                        </div>
                                    </div>
                                ) : (
                                    timelineData.map((item, i) => (
                                        <div key={item.id} className="animate-fade-in" style={{animationDelay: `${Math.min(i * 0.05, 0.3)}s`}}>
                                            {item.kind === 'msg' ? <MsgCard msg={item} /> : <TodoCardMini todo={item} />}
                                        </div>
                                    ))
                                )}
                            </div>
                        )}

                        {tab === 'msg' && (
                            <TreeHoleView 
                                messages={messages} 
                                onSend={(text) => sendData('msg', { id: generateId(), text, ts: Date.now() })} 
                                toast={showToast}
                            />
                        )}

                        {tab === 'todo' && (
                            <TodoView 
                                todos={todos} 
                                onAdd={(text) => sendData('todo', { id: generateId(), text, done: false, ts: Date.now() })}
                                onToggle={(todo) => sendData('todo', { ...todo, done: !todo.done })}
                                onDelete={(id) => {
                                    setTodos(prev => {
                                        const filtered = prev.filter(t => t.id !== id);
                                        Storage.set('yike_todos', filtered);
                                        return filtered;
                                    });
                                }}
                            />
                        )}
                    </main>

                    {/* åº•éƒ¨å¯¼èˆª */}
                    <nav className="absolute bottom-0 left-0 right-0 z-30 px-4 pb-6 pt-2">
                        <div className="glass rounded-2xl p-2 shadow-md border border-white/50 flex justify-around items-center">
                            <NavBtn icon={<Icons.List className="w-6 h-6"/>} label="å¾…åŠ" active={tab === 'todo'} onClick={() => setTab('todo')} />
                            <NavBtn icon={<Icons.Msg className="w-6 h-6"/>} label="æ ‘æ´" active={tab === 'msg'} onClick={() => setTab('msg')} />
                            <NavBtn icon={<Icons.Home className="w-7 h-7"/>} label="æ—¶å…‰" active={tab === 'home'} onClick={() => setTab('home')} isCenter={true} />
                        </div>
                    </nav>

                    {/* è®¾ç½®å¼¹çª— */}
                    {showSettings && (
                        <SettingsView 
                            anniversary={anniversary} 
                            onSave={(ts) => {
                                sendData('anniversary', ts);
                                setShowSettings(false);
                            }}
                            onClose={() => setShowSettings(false)}
                        />
                    )}

                    {/* Toast */}
                    {toast && (
                        <div className="fixed top-20 left-1/2 -translate-x-1/2 bg-gray-800/90 backdrop-blur px-5 py-2.5 rounded-full shadow-lg text-sm font-bold text-white z-50 animate-fade-in">
                            {toast}
                        </div>
                    )}
                </div>
            );
        }

        // ============ ç™»å½•é¡µç»„ä»¶ ============
        function LoginView({ myCode, connStatus, connectError, onPair, onCreate }) {
            const [inputCode, setInputCode] = useState('');
            const [copied, setCopied] = useState(false);

            const handleCopy = () => {
                navigator.clipboard.writeText(myCode).then(() => {
                    setCopied(true);
                    setTimeout(() => setCopied(false), 2000);
                }).catch(() => {
                    // Fallback
                    const textArea = document.createElement('textarea');
                    textArea.value = myCode;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    setCopied(true);
                    setTimeout(() => setCopied(false), 2000);
                });
            };

            return (
                <div className="h-full flex flex-col items-center justify-center bg-[#FDFBF7] p-6 animate-fade-in">
                    <div className="mb-8 relative">
                        <div className="w-24 h-24 rounded-full bg-[#E8CFC8]/20 flex items-center justify-center">
                            <Icons.Heart className="w-12 h-12 text-[#E8CFC8] heartbeat" />
                        </div>
                    </div>
                    <h1 className="text-5xl font-bold text-[#D4A5A5] mb-2">ä¼Šå¯</h1>
                    <p className="text-gray-400 mb-12 text-sm">æƒ…ä¾£çš„æ•°å­—ç§˜å¯†å°çª</p>
                    
                    {myCode && (
                        <div className="w-full bg-white rounded-2xl p-6 text-center shadow-sm border border-gray-100 mb-6">
                            <p className="text-xs text-gray-400 mb-4 uppercase tracking-wider">ä½ çš„ä¸“å±æš—å·</p>
                            <div onClick={handleCopy} className="bg-[#FDFBF7] p-4 rounded-xl cursor-pointer border-2 border-dashed border-gray-200 hover:border-[#E8CFC8] transition-colors jelly-btn">
                                <p className="input-code text-[#4A403A]">{myCode}</p>
                                <p className="text-xs text-gray-400 mt-2">{copied ? 'å·²å¤åˆ¶ï¼' : 'ç‚¹å‡»å¤åˆ¶åˆ†äº«ç»™TA'}</p>
                            </div>
                        </div>
                    )}
                    
                    <div className="w-full space-y-3">
                        <div className="bg-white rounded-2xl p-4 shadow-sm border border-gray-100">
                            <p className="text-xs text-gray-400 mb-2">è¾“å…¥TAçš„æš—å·</p>
                            <input 
                                className="w-full input-code text-center bg-transparent outline-none py-2 text-[#4A403A]"
                                placeholder="123456"
                                value={inputCode}
                                onChange={e => setInputCode(e.target.value.replace(/\D/g, '').slice(0, 6))}
                                maxLength={6}
                            />
                        </div>
                        
                        <button 
                            onClick={() => onPair(inputCode)}
                            disabled={inputCode.length !== 6}
                            className="w-full py-4 bg-[#E8CFC8] text-white rounded-2xl font-bold shadow-md shadow-[#E8CFC8]/30 active:scale-95 transition-transform jelly-btn disabled:opacity-50"
                        >
                            ç‰µæ‰‹è¿›å…¥å°çª
                        </button>
                        
                        <div className="flex items-center gap-4 py-2">
                            <div className="flex-1 h-px bg-gray-200"></div>
                            <span className="text-xs text-gray-400">æˆ–</span>
                            <div className="flex-1 h-px bg-gray-200"></div>
                        </div>
                        
                        <button 
                            onClick={onCreate}
                            className="w-full py-4 bg-white text-[#4A403A] rounded-2xl font-bold shadow-sm border border-gray-100 active:scale-95 transition-transform jelly-btn"
                        >
                            åˆ›å»ºæ–°å°çª
                        </button>
                    </div>
                </div>
            );
        }

        // ============ åˆ›å»ºé¡µç»„ä»¶ ============
        function CreateView({ myCode, connStatus, connectError, onBack }) {
            const [copied, setCopied] = useState(false);

            const handleCopy = () => {
                navigator.clipboard.writeText(myCode).then(() => {
                    setCopied(true);
                    setTimeout(() => setCopied(false), 2000);
                }).catch(() => {
                    const textArea = document.createElement('textarea');
                    textArea.value = myCode;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    setCopied(true);
                    setTimeout(() => setCopied(false), 2000);
                });
            };

            return (
                <div className="h-full flex flex-col items-center justify-center bg-[#FDFBF7] p-6 animate-fade-in">
                    <div className="w-20 h-20 rounded-full bg-[#E8CFC8]/20 flex items-center justify-center mb-6">
                        <Icons.Heart className="w-10 h-10 text-[#E8CFC8] heartbeat" />
                    </div>
                    <h1 className="text-3xl font-bold text-[#4A403A] mb-2">å°çªå·²åˆ›å»º</h1>
                    <p className="text-gray-400 mb-8 text-sm text-center">æŠŠæš—å·å‘ç»™TAï¼Œç­‰å¾…TAè¾“å…¥åå°±èƒ½ä¸€èµ·è¿›å…¥å°çªå•¦</p>
                    
                    <div className="w-full bg-white rounded-2xl p-6 text-center shadow-sm border border-[#E8CFC8]/20 mb-6">
                        <p className="text-xs text-[#E8CFC8] mb-4 uppercase tracking-wider font-bold">åˆ†äº«ç»™TA</p>
                        <div onClick={handleCopy} className="bg-[#FDFBF7] p-6 rounded-xl cursor-pointer border-2 border-dashed border-[#E8CFC8]/30 hover:border-[#E8CFC8] transition-colors jelly-btn">
                            <p className="input-code text-[#4A403A]">{myCode}</p>
                            <p className="text-xs text-gray-400 mt-3">{copied ? 'âœ“ å·²å¤åˆ¶ï¼' : 'ç‚¹å‡»å¤åˆ¶'}</p>
                        </div>
                    </div>
                    
                    <div className="w-full mb-4">
                        {connectError && (
                            <div className="bg-red-50 text-red-500 px-4 py-3 rounded-xl text-sm mb-3">
                                {connectError}
                            </div>
                        )}
                        
                        {connStatus === 'waiting' ? (
                            <div className="flex items-center justify-center gap-2 text-sm text-gray-500 bg-white/60 px-4 py-3 rounded-full">
                                <div className="w-2 h-2 rounded-full bg-yellow-400 animate-pulse"></div>
                                <span>ç­‰å¾…TAè¾“å…¥æš—å·...</span>
                            </div>
                        ) : connStatus === 'connected' ? (
                            <div className="flex items-center justify-center gap-2 text-sm text-green-500 bg-green-50/50 px-4 py-3 rounded-full">
                                <Icons.Check className="w-4 h-4" />
                                <span>è¿æ¥æˆåŠŸï¼</span>
                            </div>
                        ) : (
                            <div className="flex items-center justify-center gap-2 text-sm text-gray-400 bg-white/60 px-4 py-3 rounded-full">
                                <span>ç­‰å¾…ä¸­...</span>
                            </div>
                        )}
                    </div>
                    
                    <button onClick={onBack} className="text-sm text-gray-400 hover:text-gray-600 jelly-btn">
                        è¿”å›é‡æ–°åˆ›å»º
                    </button>
                </div>
            );
        }

        // ============ æ ‘æ´ç»„ä»¶ ============
        function TreeHoleView({ messages, onSend, toast }) {
            const [text, setText] = useState('');
            const messagesEndRef = useRef(null);

            useEffect(() => {
                messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            }, [messages]);

            const handleSend = () => {
                if (!text.trim()) return;
                onSend(text);
                setText('');
            };

            return (
                <div className="flex flex-col h-full pb-24">
                    <div className="flex-1 overflow-y-auto hide-scrollbar space-y-3 pt-2">
                        {messages.map(m => <MsgCard key={m.id} msg={m} />)}
                        {messages.length === 0 && (
                            <div className="flex flex-col items-center justify-center mt-20">
                                <div className="text-5xl mb-4">ğŸ“®</div>
                                <p className="text-gray-400 text-sm">æ ‘æ´ç©ºç©ºè¡è¡...</p>
                                <p className="text-xs text-gray-300 mt-1">æˆä¸ºç¬¬ä¸€ä¸ªç•™ä¸‹è¶³è¿¹çš„äººå§</p>
                            </div>
                        )}
                        <div ref={messagesEndRef} />
                    </div>
                    
                    <div className="fixed bottom-20 left-0 right-0 px-4 z-20">
                        <div className="flex items-center gap-2">
                            <input 
                                className="flex-1 bg-white/80 backdrop-blur px-4 py-3 rounded-full outline-none text-sm shadow-sm placeholder-gray-400 border border-white/50"
                                placeholder="è¯´ç‚¹ä»€ä¹ˆ..."
                                value={text}
                                onChange={e => setText(e.target.value)}
                                onKeyDown={e => e.key === 'Enter' && handleSend()}
                            />
                            <button 
                                onClick={handleSend}
                                disabled={!text.trim()}
                                className={`w-12 h-12 rounded-full flex items-center justify-center transition-all jelly-btn ${text.trim() ? 'bg-[#E8CFC8] text-white shadow-md' : 'bg-gray-100 text-gray-300'}`}
                            >
                                <Icons.Send className="w-5 h-5" />
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // ============ å¾…åŠç»„ä»¶ ============
        function TodoView({ todos, onAdd, onToggle, onDelete }) {
            const [text, setText] = useState('');
            
            const handleAdd = () => {
                if (!text.trim()) return;
                onAdd(text);
                setText('');
            };

            return (
                <div className="space-y-3 pb-24">
                    <div className="flex gap-2">
                        <input 
                            className="flex-1 bg-white p-3 rounded-xl outline-none text-sm shadow-sm placeholder-gray-400 border border-gray-100"
                            placeholder="æ·»åŠ å°äº‹..."
                            value={text}
                            onChange={e => setText(e.target.value)}
                            onKeyDown={e => e.key === 'Enter' && handleAdd()}
                        />
                        <button onClick={handleAdd} className="w-12 h-12 rounded-xl bg-[#E8CFC8] text-white flex items-center justify-center jelly-btn">
                            <Icons.Plus className="w-5 h-5" />
                        </button>
                    </div>
                    
                    <div className="space-y-2">
                        {todos.map(todo => (
                            <div key={todo.id} className="flex items-center gap-3 bg-white/80 p-3 rounded-xl border border-white/50 transition-all animate-slide-up">
                                <button 
                                    onClick={() => onToggle(todo)}
                                    className={`w-6 h-6 rounded-full border-2 flex items-center justify-center flex-shrink-0 jelly-btn ${todo.done ? 'bg-[#D4E4E6] border-[#D4E4E6]' : 'border-gray-300 hover:border-[#E8CFC8]'}`}
                                >
                                    {todo.done && <Icons.Check className="w-3 h-3 text-white" />}
                                </button>
                                <span className={`flex-1 text-sm ${todo.done ? 'line-through text-gray-400' : 'text-[#4A403A]'}`}>
                                    {todo.text}
                                </span>
                                <button onClick={() => onDelete(todo.id)} className="p-2 text-gray-300 hover:text-red-400 jelly-btn">
                                    <Icons.Trash className="w-4 h-4" />
                                </button>
                            </div>
                        ))}
                    </div>
                    
                    {todos.length === 0 && (
                        <div className="flex flex-col items-center justify-center mt-16">
                            <div className="text-5xl mb-4">âœ¨</div>
                            <p className="text-gray-400 text-sm">è¿˜æ²¡æœ‰å¾…åŠäº‹é¡¹</p>
                        </div>
                    )}
                </div>
            );
        }

        // ============ é€šç”¨ç»„ä»¶ ============
        function NavBtn({ icon, label, active, onClick, isCenter }) {
            return (
                <button onClick={onClick} className={`flex flex-col items-center justify-center py-2 px-4 rounded-xl transition-all jelly-btn ${active ? 'text-[#E8CFC8]' : 'text-gray-400 hover:text-gray-600'}`}>
                    <div className={isCenter ? 'mb-1' : ''}>{icon}</div>
                    <span className={`text-[10px] font-medium ${active ? 'text-[#E8CFC8]' : ''}`}>{label}</span>
                </button>
            );
        }

        function MsgCard({ msg }) {
            return (
                <div className={`flex ${msg.self ? 'justify-end' : 'justify-start'}`}>
                    <div className={`max-w-[80%] px-4 py-3 rounded-2xl shadow-sm text-sm ${msg.self ? 'bg-[#E8CFC8] text-white rounded-br-sm' : 'bg-white text-[#4A403A] rounded-bl-sm'}`}>
                        {msg.text}
                        <div className={`text-[10px] mt-1 ${msg.self ? 'text-white/70' : 'text-gray-400'}`}>{formatTime(msg.ts)}</div>
                    </div>
                </div>
            );
        }

        function TodoCardMini({ todo }) {
            return (
                <div className={`flex items-center gap-2 p-2.5 rounded-lg text-xs ${todo.done ? 'bg-white/30 line-through text-gray-400' : 'bg-[#E8CFC8]/20 text-[#4A403A]'}`}>
                    <div className={`w-1.5 h-1.5 rounded-full ${todo.done ? 'bg-gray-300' : 'bg-[#E8CFC8]'}`}></div>
                    <span className="flex-1 truncate">{todo.text}</span>
                    <span className="text-[10px] opacity-60">{new Date(todo.ts).toLocaleTimeString('zh-CN', {hour:'2-digit', minute:'2-digit'})}</span>
                </div>
            );
        }

        function SettingsView({ anniversary, onSave, onClose }) {
            const [date, setDate] = useState(anniversary ? formatDateOnly(anniversary) : '');

            return (
                <div className="fixed inset-0 z-50 bg-black/30 backdrop-blur-sm flex items-end justify-center animate-fade-in">
                    <div className="bg-[#FDFBF7] w-full max-w-[400px] rounded-t-3xl p-6 shadow-2xl animate-slide-up">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-xl font-bold text-[#4A403A]">å°çªè®¾ç½®</h2>
                            <button onClick={onClose} className="w-8 h-8 rounded-full bg-white text-gray-400 flex items-center justify-center hover:bg-gray-100 jelly-btn">
                                <Icons.Close className="w-4 h-4" />
                            </button>
                        </div>
                        
                        <div className="space-y-6">
                            <div className="space-y-2">
                                <label className="flex items-center gap-2 text-sm font-bold text-[#4A403A]">
                                    <Icons.Calendar className="w-4 h-4 text-[#E8CFC8]" />
                                    çºªå¿µæ—¥
                                </label>
                                <input 
                                    type="date" 
                                    className="w-full p-4 rounded-xl bg-white outline-none text-[#4A403A] shadow-sm border border-gray-100"
                                    value={date}
                                    onChange={e => setDate(e.target.value)}
                                />
                                <p className="text-xs text-gray-400">è®¾ç½®æˆ‘ä»¬åœ¨ä¸€èµ·çš„ç¬¬ä¸€å¤©</p>
                            </div>
                            
                            <button onClick={() => onSave(date ? new Date(date).getTime() : Date.now())} className="w-full py-4 bg-[#E8CFC8] text-white rounded-2xl font-bold shadow-lg shadow-[#E8CFC8]/30 active:scale-95 transition-transform jelly-btn">
                                ä¿å­˜è®¾ç½®
                            </button>
                            
                            <div className="pt-4 border-t border-gray-200">
                                <button onClick={() => { if(confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿ')) { Storage.clearAll(); window.location.reload(); } }} className="w-full py-3 text-sm text-red-400 hover:bg-red-50 rounded-xl transition-colors jelly-btn">
                                    æ¸…ç©ºæ‰€æœ‰æ•°æ®
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // ============ æ¸²æŸ“åº”ç”¨ ============
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
